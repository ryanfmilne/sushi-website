---
import Layout from "../layouts/Layout.astro";
import MenuCard from "../components/MenuCard.astro";
import SpecialsCard from "../components/SpecialsCard.astro";
import HoursDisplay from "../components/HoursDisplay.astro";

// Import and fetch menu items (featured ones for homepage)
import { getCollection } from "astro:content";
const menuItems = await getCollection("menu", ({ data }) => {
  return data.published === true;
});

// Get just a few items for the homepage (one from each category)
const featuredMenuItems = Object.values(
  menuItems.reduce((acc, item) => {
    if (!acc[item.data.category]) {
      acc[item.data.category] = item;
    }
    return acc;
  }, {})
).slice(0, 4);

// Import and fetch specials
const specialsItems = await getCollection("specials", ({ data }) => {
  // Show only featured specials or the most recent ones
  return data.featured === true || new Date(data.endDate) >= new Date();
});

// Sort specials by endDate (closest ending first) and take top 2
const featuredSpecials = [...specialsItems]
  .sort(
    (a, b) =>
      new Date(a.data.endDate).getTime() - new Date(b.data.endDate).getTime()
  )
  .slice(0, 2);
---

<Layout title="Welcome to Our Restaurant">
  <!-- Hero Section -->
  <section class="relative">
    <div
      class="h-[70vh] bg-gradient-to-r from-stone-800 to-stone-900 flex items-center">
      <div class="absolute inset-0 overflow-hidden">
        <img
          src="/images/hero-image.jpg"
          alt="Restaurant hero image"
          class="w-full h-full object-cover opacity-40"
        />
      </div>
      <div class="container mx-auto px-4 relative z-10 text-center">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4">
          Experience Culinary Excellence
        </h1>
        <p class="text-xl text-white/80 max-w-2xl mx-auto mb-8">
          Delicious cuisine crafted with passion and the finest ingredients.
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <a
            href="/menu"
            class="bg-amber-600 hover:bg-amber-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
            View Our Menu
          </a>
          <a
            href="/contact"
            class="bg-white hover:bg-stone-100 text-stone-800 px-6 py-3 rounded-md font-medium transition-colors">
            Make a Reservation
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="py-16 bg-stone-50">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl font-bold mb-6">Our Story</h2>
        <p class="text-lg text-stone-700 mb-6">
          Founded in 2010, our restaurant has been serving the community with
          authentic cuisine made from locally-sourced ingredients. Our chefs
          bring decades of culinary expertise to create memorable dining
          experiences for our guests.
        </p>
        <p class="text-lg text-stone-700">
          We believe in sustainable practices, supporting local farmers, and
          creating dishes that celebrate the rich culinary traditions of our
          region while adding our own unique modern twist.
        </p>
      </div>
    </div>
  </section>

  <!-- Featured Menu Section -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold mb-4">Featured Menu Items</h2>
        <p class="text-lg text-stone-600 max-w-2xl mx-auto">
          Explore some of our most popular dishes, crafted with care and the
          finest ingredients.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {
          featuredMenuItems.map((item) => (
            <MenuCard
              title={item.data.title}
              price={item.data.price}
              description={item.data.description}
              image={item.data.image}
              vegetarian={item.data.vegetarian}
              vegan={item.data.vegan}
              glutenFree={item.data.glutenFree}
              spicyLevel={item.data.spicyLevel}
            />
          ))
        }
      </div>

      <div class="text-center mt-8">
        <a
          href="/menu"
          class="inline-flex items-center text-amber-600 font-medium hover:text-amber-700">
          View Full Menu
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-5 h-5 ml-1">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Specials Section -->
  {
    featuredSpecials.length > 0 && (
      <section class="py-16 bg-amber-50">
        <div class="container mx-auto px-4">
          <div class="text-center mb-12">
            <h2 class="text-3xl font-bold mb-4">Current Specials</h2>
            <p class="text-lg text-stone-600 max-w-2xl mx-auto">
              Don't miss our limited-time offers and seasonal specialties.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
            {featuredSpecials.map((special) => (
              <SpecialsCard
                title={special.data.title}
                startDate={new Date(special.data.startDate)}
                endDate={new Date(special.data.endDate)}
                description={special.data.description}
                price={special.data.price}
                regularPrice={special.data.regularPrice}
                image={special.data.image}
                featured={special.data.featured}
              />
            ))}
          </div>

          <div class="text-center mt-8">
            <a
              href="/specials"
              class="inline-flex items-center text-amber-600 font-medium hover:text-amber-700">
              View All Specials
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-5 h-5 ml-1">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"
                />
              </svg>
            </a>
          </div>
        </div>
      </section>
    )
  }

  <!-- Hours & Reservation Section -->
  <section class="py-16 bg-stone-100">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-4xl mx-auto">
        <div>
          <h2 class="text-2xl font-bold mb-6">Hours of Operation</h2>
          <HoursDisplay className="bg-white p-6 rounded-lg shadow-md" />
        </div>

        <div>
          <h2 class="text-2xl font-bold mb-6">Make a Reservation</h2>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <p class="text-stone-600 mb-4">
              Reserve your table to ensure the best dining experience. We look
              forward to serving you!
            </p>
            <a
              href="/contact"
              class="block w-full bg-amber-600 hover:bg-amber-700 text-white text-center px-6 py-3 rounded-md font-medium transition-colors">
              Contact Us for Reservations
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>
